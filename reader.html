<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reader</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>
    <style>
        body { margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; background: #fff;}
        #viewer { flex: 1; width: 100%; height: 100%; }
        #controls { 
            height: 50px; display: flex; justify-content: space-between; align-items: center; 
            background: #eee; padding: 0 20px; box-sizing: border-box;
        }
        button { padding: 5px 15px; font-size: 16px; cursor: pointer;}
        a { text-decoration: none; color: #333; font-weight: bold; }
    </style>
</head>
<body>

    <div id="viewer"></div>
    
    <div id="controls">
        <a href="index.html">← 戻る</a>
        <div>
            <button id="prev" onclick="rendition.prev()">＜ 前へ</button>
            <button id="next" onclick="rendition.next()">次へ ＞</button>
        </div>
    </div>

    <script>
        // URLパラメータからファイル名を取得 (?book=epubs/1.epub)
        const params = new URLSearchParams(window.location.search);
        const url = params.get('book');

        if (!url) {
            alert("本が指定されていません。一覧に戻ります。");
            window.location.href = "index.html";
        }

        // 簡易認証チェック（URL直打ち対策・簡易）
        if (sessionStorage.getItem('auth') !== 'true') {
            alert("ログインしてください。");
            window.location.href = "index.html";
        }

        // ePubの表示設定
        const book = ePub(url);
        const rendition = book.renderTo("viewer", {
            width: "100%",
            height: "100%",
            flow: "scrolled-doc" // スクロール読み（漫画や小説向け）
            // ページめくり式がいい場合は flow: "paginated" に変更してください
        });

        rendition.display();

        // キーボード操作対応
        document.addEventListener("keyup", function(e) {
            if ((e.keyCode || e.which) == 37) rendition.prev(); // 左キー
            if ((e.keyCode || e.which) == 39) rendition.next(); // 右キー
        });
    </script>
</body>
</html>
